[![Build Status](https://travis-ci.org/o10n-x/wordpress-pwa-optimization.svg?branch=master)](https://travis-ci.org/o10n-x/wordpress-pwa-optimization) ![Version](https://img.shields.io/github/release/o10n-x/wordpress-pwa-optimization.svg)

# WordPress Progressive Web App Optimization [beta]

Advanced Progressive Web App (PWA) and Service Worker optimization toolkit. Cache strategy, offline browsing, preloading, Google Lighthouse PWA validation and more.

* [Documentation](https://github.com/o10n-x/wordpress-pwa-optimization/tree/master/docs)
* [Description](https://github.com/o10n-x/wordpress-pwa-optimization#description)
* [Version history (Changelog)](https://github.com/o10n-x/wordpress-pwa-optimization/releases)
* [About WordPress WPO Collection](https://github.com/o10n-x/wordpress-pwa-optimization#wordpress-wpo-collection)

## Installation

![Github Updater](https://github.com/afragen/github-updater/raw/develop/assets/GitHub_Updater_logo_small.png)

This plugin can be installed and updated using [Github Updater](https://github.com/afragen/github-updater) ([installation instructions](https://github.com/afragen/github-updater/wiki/Installation))

<details/>
  <summary>Installation instructions</summary>

### Step 1: Install Github Updater and first optimization plugin

Installing and updating the plugins is possible using Github Updater. It is easy to install one of the plugins. You simply need to download the Github Updater plugin ([zip file](https://github.com/afragen/github-updater/archive/develop.zip)), install it from the WordPress plugin admin panel and copy the Github URL of the plugin into the Github Updater installer.

![image](https://user-images.githubusercontent.com/8843669/39889846-46158cc2-5499-11e8-824d-720020f758db.png)

### Step 2: Install other optimization plugins with a single click

A recent update of all plugins contains a easy single click install button.

![image](https://user-images.githubusercontent.com/8843669/39661507-cc1eac5e-5052-11e8-8fba-33c0cc959b07.png)
</details>

## Beta Notice

This plugin is a **first beta** which was [banned from WordPress.org](https://docs.style.tools/cms-plugins/wordpress/ban) for a yet unknown motive. Due to the ban, the plugin did not receive the extensive user feedback that was originally planned to complete the plugin. A lot of planned improvements and features were never added. 

The plugin also experienced issues with funding. The investment by a partner (who took on a role as CEO) that was agreed mid 2017 was paid in the beginning of 2018, resulting in a delay and a greatly reduced version of the originally planned **Advanced Optimization** plugin (the bigger plugin was stripped of features and cut into individual plugins).

The CEO partner did not appear to have been honest. He spent his time meeting with billionaires and ultimately simply walked away from the project as if he did not care about it. He has been given full freedom and support to deliver results, but regrettably, it seems that his intend has been to waste time on purpose, which is also evident from the choice to wait over half a year to release the R&D funding.

Considering the difficult to explain events that struck the company/project, the following link provides details about the CEO's involvement and the project's history.

<details/>
  <summary>Show project history</summary>

_The following text was written from the perspective of the founder._

The original plan for the project was simple: find an experienced and educated CEO and efficiently create an optimization agency of (potentially) +100 employees. In essence, the creation of a modern age SEO agency. An optimization power house that could serve businesses well, that could provide challenging and rewarding projects to website performance optimization specialists and enhance the field with cutting edge innovations.

Mid 2017 a partner and investor was found. One of the reasons to choose for the partner was because of the misconception that he held a Harvard MBA. (it was later discovered that I misread an article). He was owner of a successful US film business in Los Angeles and he showed affection for SEO/online success from a business owner perspective.

It quickly became evident that the CEO wanted to keep things small. That has been respected.

The first and foremost essential task was to create a strategy. 

The CEO agreed in writing and promised to contribute a business strategy but he did not fulfill that agreement. The CEO chose to meet with billionaires, some of whom were his personal friends. All that I could do is wait and ask questions related to strategy and viability of the CEO's plans.

There has been tremendous patience from my side. 

I've spent my time demanding a strategy for the company while maintaining a position as enabler, providing the CEO with freedom (i.e. weeks or months of waiting) to simply answer simple questions that could guide him into the good direction. 

The CEO kept dodging my questions, demanding to wait for billionaires with whom he was meeting. He paired that with promises and continuously communicated enthusiasm. The CEO has spent about 2 years meeting with billionaires, apparently (considering the lack of results) to beg for money without a specific purpose, while leaving me and other partners in the dark (little to no communication).

The CEO continuously communicated enthusiasm, thereby it was not possible for me to conclude that he wasn't going to deliver on his promises. It urged me and other partners to keep waiting.

### Wasting time on purpose

When looking back today, the billionaire strategy from the CEO occurs to have been some sort of joke to waste time on purpose. There have been many signs of intentional stalling. For example, the investment was paid at the beginning of 2018 (over 6 months waiting). While it was legally sound, it hurt R&D, the most vital part of the company that he invested in. If the CEO did not have sufficient trust in the partners, he should not have invested. So why withhold the funds to get the company going? (I did not push the CEO to pay sooner, early on there was simply only respect and patience for the decisions of the CEO, therefor it was decided to wait).

While the CEO did share contact details of real billionaires, pasting big photographs of a billionaire with whom he was going to meet etc., some of the parties that he communicated with using the company email were named like "Billionaires Together", which seems questionable. The admin email address of his company website was info [at] billionairsclub.com. 

The lack of results and the CEO ultimately walking away after first stopping to communicate for months, shortly after having made new promises (to meet a billionaire), occurs as a scam. 

I've asked the CEO many times: what does a billionaire want with PSP? Why did he believe that contacting billionaires would lead to results? He did not provide an answer.

It was his responsibility to deliver results. I've simply been patient and asked questions to force the creation of a strategy (or at least communication of incompetence so that actions could be taken).

After a year it became evident that the CEO was not able to deliver results. About 3 months before a company renewal bill would put the company into trouble since it had no cash to pay it, I started to communicate my concerns in regards to the CEO's functioning. By the time the bill was up it had escalated to such extent that the CEO was literally called a failure. 

The CEO then paid that bill out of his pocket and paired it with new promises. He was going to meet a billionaire from Las Vegas.

During those 3 months, other signs of intentional stalling arose. When communication escalated in regards to his functioning, the CEO started to defend or excuse failure. He provided arguments like:

> Rembrandt von Gogh died poor and only became famous after he died. 

And: `most startups fail` with the link https://www.forbes.com/sites/neilpatel/2015/01/16/90-of-startups-will-fail-heres-what-you-need-to-know-about-the-10/

What was I to think of such arguments? 

I've communicated: `I only care about results` and `failure is not an option` and kept doing my part to get the CEO on track to provide (communicate) a strategy or plan. It was what we agreed on before he invested and the only thing that could direct the company on a path to success. It was in the hands of the CEO.

## CEO was offered to resign but held on to his position

Considering the issues, the CEO was asked - friendly - whether he wanted to remain appointed as CEO. He consciously and enthusiastically chose to remain appointed as CEO, again paired with new promises, therefor taking responsibility for the success of the company. He never provided a sign that the issue with the ban on WordPress would hinder the success of the company (which would not need to be since it's IP was not dependent on WordPress), therefor there was no other option for me then to have chosen the path to hold the CEO accountable.

Considering the public impact of the project and the 20,000 highly intelligent users of the ABTF plugin who were watching the project, there has been no suspicion towards the CEO. He has simply been given 100% freedom and support to deliver results. The communication quality has been maintained in good order. 

The public impact makes it unlikely that it was a random scam or joke. A random failure can't be defended either as there was no strategy that could have failed. "Contacting billionaires" is not a strategy and there was never an answer to questions why such a strategy could have been successful.

If the CEO communicated, he could have been forgiven. He has left me in the dark, essentially 'waiting for no reason', and it seems to have been intentional.

![strategy](https://user-images.githubusercontent.com/8843669/50248966-0818a780-03dd-11e9-87e5-4ca0a70628c5.png)
...
![psp](https://user-images.githubusercontent.com/8843669/50249383-2c28b880-03de-11e9-9595-ce6e2eeb6451.png)

---

**Note:** at the moment of the above writing the CEO had apparently disappeared for 2 months and stopped communicating, despite pending new promises to deliver results from his side (after consciously holding on to his CEO position when asked if he wanted to leave). Only after reading his inbox and contacting one of his personal investment partners communication was restored.

My question in regards to the company had remained pending for months.

![image](https://user-images.githubusercontent.com/8843669/48669716-8cd88300-eb0a-11e8-99b1-ae7220aab6c6.png)

### Transparency

This message is not intended as retaliation towards the CEO. It is simply provided as transparency, considering the difficult to explain events that struck the company/project. 

### Update (december 2018): CEO walked away

The CEO started to communicate that he wanted to give up and proposed to close the company and have the IP be returned to the founder. It was not perceived as righteous.

> Dear Suren,
>
> I understand that you are now trying to walk away, leaving behind your investment, while having no argument against me or the technology. You try to make it look as a generous action from your side, but it's not righteous.
> 
> A few months ago you held on firmly to your CEO position when asked friendly, while considering that your functioning as CEO had increasingly become questioned for lack of results and broken promises, if you wanted to leave.
> 
> Months of waiting followed. New promises were unmet again. Due to little to no communication from your side it has been perceived as "waiting for no reason".
> 
> In essence, a full year of time has been wasted for no apparent reason and there has been no indication that it matters to you.
>
> ...
>
> **Billionaire strategy**
> 
> The term 'billionaire' has returned often in your communication. It appears to have been a key aspect of your original plan/strategy before you invested in PSP. For example, I noticed that the admin email of your website www..com was set to info@billionairsclub.com.
> 
> I didn't want to think anything of it. Maybe you simply want to become a billionaire and it is a motivating dream to imagine being part of a billionaires club, or maybe you are in fact part of a billionaires club. For PSP it would not matter, the only thing that matters is getting results.
> 
> What I can conclude from our past communication and replies to my questions regarding vision and strategy is that you have been focused on 'billionaires'.
> 
> I noticed that you are communicating with **Billionaires in .. LLC** on behalf of PSP. What was your angle with that and why didn't it lead to results?
> 
> What happened with your meeting with the billionaire from Las Vegas?
> 
> What could a billionaire want with PSP? Why did you believe that focusing on billionaires would lead PSP to success?
> 
> An answer to these questions is important. You held on to your CEO role a few months ago and have kept the company waiting for almost a year. There are great losses, not just for the company but also to it's many beneficiaries. I noticed that the lawyer also expects to receive $10k. How is PSP going to pay that?
> 
> It is simply not righteous to now walk away as if a 9 out of 10 startup failed.

---

</details>

The original plan for the **Advanced Optimization** plugin had 3 stages:

1) publication of a high quality optimization plugin (Google Lighthouse optimization + beyond)
2) make the JSON optimization config popular (it can save a lot of time, easy to get free help (JSON knowledge) on forums, easy for examples in tutorials etc)
3) use the optimization intelligence data unlocked through the JSON documents to create an AI automation service (API) that can provide the best possible performance result on per-page, per-device and even individual visitor level.

The AI service would be an external service, independent from the free and open source plugin. The port for the AI would also be open source, allowing other solutions to make use of it's potential for automation.

Stage 1 was completed. 

Thanks to the valuable feedback from Github users, the WPO plugins did receive feedback. The quality of the plugins is very good, however, in sense of usability/documentation there are simply unresolved issues.

### Demo

The plugins are able to deliver results for SEO. Our www.e-scooter.co demo website (started in 2018) ranks in the top 10 in Google in many countries and received visitors from 211 countries and is now visited from 174 countries every week on average. The demo website ranks #1 for many scooters globally. 

**The WPO plugins are operating sublimely.**

![WPO plugins demo](https://github.com/o10n-x/wordpress-o10n-core/blob/master/docs/images/google-rankings-international.png)

It will take a bit more effort, and maybe some more feedback from users, but then the WPO plugins could simply be a great tool for achieving Google Lighthouse 100-scores and even better performance results (speed) than would be required for a 100-score (the plugins provide unique innovations such as timed javascript execution and CSS rendering, advanced Web Worker based preload logic, preload on mouse-down and [Service Worker Push](https://github.com/o10n-x/wordpress-http2-optimization/wiki/HTTP-2-Server-Push-vs-Service-Worker-Push) with better performance than HTTP/2 Server Push).

## Description

This plugin is a toolkit for Progressive Web App and Service Worker optimization.

The plugin provides in a complete solution for service worker based performance optimization and enables to validate a website as a Progressive Web App (PWA) in [Google Lighthouse](https://developers.google.com/web/tools/lighthouse/).

The service worker can be configured with multiple cache strategies (cache first, network with fallback and event based), offline content, smart preloading, preload on mousedown to improve navigation speed and many more options to enable offline browsing and improved navigation performance.

![Service Worker Optimization](https://github.com/o10n-x/wordpress-pwa-optimization/blob/master/docs/images/service-worker-optimization.png)
![Service Worker Cache Policy Optimization](https://github.com/o10n-x/wordpress-pwa-optimization/blob/master/docs/images/service-worker-cache-policy.png)

### Cache Policy

The Service Worker cache policy can be configured using JSON.

![Service Worker Cache Policy](https://github.com/o10n-x/wordpress-pwa-optimization/blob/master/docs/images/cache-policy.png)

### Service Worker Push

The plugin provides a unique innovation called **Service Worker Push**. It is an alternative for HTTP/2 Server Push + Cache-Digest with better performance and better efficiency.

Cache-Digest is not yet an official supported feature. HTTP/2 Server Push without Cache-Digest causes a lot of overhead and has almost no performance advantage.

- Performance study: https://calendar.perfplanet.com/2016/cache-digests-http2-server-push/
- Google engineer: https://jakearchibald.com/2017/h2-push-tougher-than-i-thought/

Cache-Digest calculation for thousands of assets causes overhead. Service Worker Push has direct access to the browser cache storage and is therefor able to support millions of cached assets without performance loss.

Service Worker Push uses PHP method `\O10n\attach_preload()` to attach assets such as images, stylesheets and scripts to a page which are then exposed to a Service Worker using a HTTP header. The Service Worker is then able to preload assets intelligently on the basis of a page URL.

```php
/* Attach assets to page for smart preloading in the Service Worker */
add_action('init', function() {

    if (function_exists('O10n\attach_preload')) {

        // attach single asset to page
        \O10n\attach_preload('/path/to/image.jpg');

        // attach multiple assets to page
        \O10n\attach_preload(array('/path/to/image.jpg', 'https://cdn.google.com/script.js', '/path/to/stylesheet.css'));

    }
});
```

### Background Fetch

A performance flaw of Service Workers is that they initiate Fetch requests that cannot be cancelled when a user wants to navigate which can slow and even block navigation. This plugin provides a unique innovation in which Fetch requests can be performed in a regular Web Worker that can be terminated when a user wants to navigate, instantly cancelling any Fetch requests or background tasks.

![Background Fetch](https://github.com/o10n-x/wordpress-pwa-optimization/blob/master/docs/images/background-fetch.png)

### Web App Manifest Editor

The plugin provides a Web App `manifest.json` and meta editor to easily optimize the web app configuration.

![Web App Manifest Editor](https://github.com/o10n-x/wordpress-pwa-optimization/blob/master/docs/images/manifest-editor.png)

Additional features can be requested on the [Github forum](https://github.com/o10n-x/wordpress-pwa-optimization/issues).

## WordPress WPO Collection

This plugin is part of a Website Performance Optimization collection that include [CSS](https://github.com/o10n-x/wordpress-css-optimization), [Javascript)](https://github.com/o10n-x/wordpress-javascript-optimization), [HTML](https://github.com/o10n-x/wordpress-html-optimization), [Web Font](https://github.com/o10n-x/wordpress-font-optimization), [HTTP/2](https://github.com/o10n-x/wordpress-http2-optimization) and [Security Header](https://github.com/o10n-x/wordpress-security-header-optimization) optimization. 

The WPO optimization plugins provide in all essential tools that enable to achieve perfect [Google Lighthouse Test](https://developers.google.com/web/tools/lighthouse/) scores and to validate a website as [Google PWA](https://developers.google.com/web/progressive-web-apps/), an important ranking factor for Google's [Speed Update](https://searchengineland.com/google-speed-update-page-speed-will-become-ranking-factor-mobile-search-289904) (July 2018).

![Google Lighthouse Perfect Performance Scores](https://github.com/o10n-x/wordpress-css-optimization/blob/master/docs/images/google-lighthouse-pwa-validation.jpg)

The WPO optimization plugins are designed to work together with single plugin performance. The plugins provide the latest optimization technologies and many unique innovations.

### JSON configuration

100% of the WPO plugin settings are controlled by JSON. This means that you could use the plugins without ever using the WordPress admin forms.

The JSON is verified using JSON schema's. More info about [JSON schemas](https://github.com/o10n-x/wordpress-o10n-core/tree/master/schemas).

### Local editing of optimization settings

A recently added [Stealth Optimization Config Proxy](https://github.com/o10n-x/wordpress-http2-optimization/releases/tag/0.0.55) concept makes it possible to edit the plugin settings using physical `.json` files from a local editor (with auto upload) making it efficient for fine tuning optimization settings. An update would cost a second compared to using + saving a WordPress admin panel.

https://github.com/o10n-x/wordpress-http2-optimization/releases/tag/0.0.55

## Google PageSpeed vs Google Lighthouse Scores

While a Google PageSpeed 100 score is still of value, websites with a high Google PageSpeed score may score very bad in Google's new [Lighthouse performance test](https://developers.google.com/web/tools/lighthouse/). 

The following scores are for the same site. It shows that a perfect Google PageSpeed score does not correlate to a high Google Lighthouse performance score.

![Perfect Google PageSpeed 100 Score](https://github.com/o10n-x/wordpress-css-optimization/blob/master/docs/images/google-pagespeed-100.png) ![Google Lighthouse Critical Performance Score](https://github.com/o10n-x/wordpress-css-optimization/blob/master/docs/images/lighthouse-performance-15.png)

### Google PageSpeed score is outdated

For the open web to have a chance of survival in a mobile era it needs to compete with and win from native mobile apps. Google is dependent on the open web for it's advertising revenue. Google therefor seeks a way to secure the open web and the main objective is to rapidly enhance the quality of the open web to meet the standards of native mobile apps.

For SEO it is therefor simple: websites will need to meet the standards set by the [Google Lighthouse Test](https://developers.google.com/web/tools/lighthouse/) (or Google's future new tests). A website with perfect scores will be preferred in search over low performance websites. The officially announced [Google Speed Update](https://searchengineland.com/google-speed-update-page-speed-will-become-ranking-factor-mobile-search-289904) (July 2018) shows that Google is going as far as it can to drive people to enhance the quality to ultra high levels, to meet the quality of, and hopefully beat native mobile apps.

A perfect Google Lighthouse Score includes validation of a website as a [Progressive Web App (PWA)](https://developers.google.com/web/progressive-web-apps/).

Google offers another new website performance test that is much tougher than the Google PageSpeed score. It is based on a AI neural network and it can be accessed on https://testmysite.thinkwithgoogle.com
